{
  "generatedAt": "2025-12-04T00:00:00.000Z",
  "architecture": "SimplePlacement",
  "status": "Working (MVP)",
  "completeness": "40%",
  
  "files": [
    {
      "path": "src/pages/Customizer.tsx",
      "purpose": "Main page component with wizard and placement flow",
      "status": "active",
      "lines": 250
    },
    {
      "path": "src/components/customizer/ProductWizard.tsx",
      "purpose": "Multi-step product selection modal (4 product types)",
      "status": "active",
      "lines": 371
    },
    {
      "path": "src/components/customizer/SimplePlacementCanvas.tsx",
      "purpose": "Canvas for rendering mockup + single design with preset placement",
      "status": "active",
      "lines": 234
    },
    {
      "path": "src/components/customizer/SimplePlacementPanel.tsx",
      "purpose": "Left sidebar with upload, placement, scale, color, size controls",
      "status": "active",
      "lines": 303
    },
    {
      "path": "src/components/customizer/SimplePreviewModal.tsx",
      "purpose": "Preview modal for design output with download",
      "status": "active",
      "lines": 105
    },
    {
      "path": "src/config/productTemplates.ts",
      "purpose": "Product definitions (12 product variants)",
      "status": "active",
      "lines": 652
    },
    {
      "path": "src/config/printAreas.ts",
      "purpose": "Print zone coordinates by product type and side",
      "status": "active",
      "lines": 184
    },
    {
      "path": "src/config/placements.ts",
      "purpose": "TypeScript types for design data and preview",
      "status": "active",
      "lines": 22
    },
    {
      "path": "src/types/customizer.ts",
      "purpose": "Core TypeScript interfaces for customizer system",
      "status": "active",
      "lines": 112
    },
    {
      "path": "src/utils/canvasHelpers.ts",
      "purpose": "Image resize and canvas export utilities",
      "status": "active",
      "lines": 35
    },
    {
      "path": "src/utils/printAreaEditor.tsx",
      "purpose": "Dev-mode interactive print area editor tool",
      "status": "active",
      "lines": 295
    },
    {
      "path": "src/store/cart.ts",
      "purpose": "Shopping cart Zustand store (not integrated with customizer)",
      "status": "active",
      "lines": 58
    },
    {
      "path": "src/store/customizer.ts",
      "purpose": "Full-featured Zustand store with multi-design, undo/redo (UNUSED)",
      "status": "inactive",
      "lines": 308
    },
    {
      "path": "src/store/customizerStore.ts",
      "purpose": "Fabric.js-based store implementation (ORPHANED)",
      "status": "inactive",
      "lines": 110
    },
    {
      "path": "src/components/customizer/ProductCanvas.tsx",
      "purpose": "Multi-design canvas with drag/drop (REPLACED)",
      "status": "inactive",
      "lines": 326
    },
    {
      "path": "src/components/customizer/PreviewModal.tsx",
      "purpose": "Alternative preview modal (NOT USED)",
      "status": "inactive",
      "lines": 355
    }
  ],
  
  "components": [
    {
      "name": "CustomizerPage",
      "file": "src/pages/Customizer.tsx",
      "props": {},
      "state": {
        "showWizard": "boolean",
        "showChangeProduct": "boolean",
        "showPreview": "boolean",
        "previewData": "PreviewData | null",
        "editorMode": "boolean",
        "mockupDimensions": "{ width: number, height: number }",
        "productId": "string",
        "currentSide": "ProductSide",
        "selectedColor": "string",
        "selectedSize": "string",
        "designImage": "string | null",
        "selectedPlacement": "string | null",
        "scale": "number"
      },
      "effects": [
        "None (pure component)"
      ]
    },
    {
      "name": "ProductWizard",
      "file": "src/components/customizer/ProductWizard.tsx",
      "props": {
        "onComplete": "(selection: ProductSelection) => void",
        "onCancel": "() => void"
      },
      "state": {
        "currentStep": "number (1-4)",
        "selection": "ProductSelection"
      },
      "effects": [
        "None"
      ]
    },
    {
      "name": "SimplePlacementCanvas",
      "file": "src/components/customizer/SimplePlacementCanvas.tsx",
      "props": {
        "productId": "string",
        "currentSide": "ProductSide",
        "selectedColor": "string",
        "designImage": "string | null",
        "selectedPlacement": "string | null",
        "scale": "number",
        "onCanvasReady": "(canvas: HTMLCanvasElement) => void"
      },
      "state": {
        "mockupDimensions": "{ width: number, height: number }"
      },
      "effects": [
        "Canvas redraw on prop changes",
        "Async image loading (mockup + design)",
        "Calls onCanvasReady after render"
      ]
    },
    {
      "name": "SimplePlacementPanel",
      "file": "src/components/customizer/SimplePlacementPanel.tsx",
      "props": {
        "productId": "string",
        "currentSide": "ProductSide",
        "selectedColor": "string",
        "selectedSize": "string",
        "designImage": "string | null",
        "selectedPlacement": "string | null",
        "scale": "number",
        "onSideChange": "(side: ProductSide) => void",
        "onColorChange": "(color: string) => void",
        "onSizeChange": "(size: string) => void",
        "onImageUpload": "(image: string) => void",
        "onPlacementChange": "(placement: string) => void",
        "onScaleChange": "(scale: number) => void",
        "onGeneratePreview": "() => void",
        "onChangeProduct": "() => void"
      },
      "state": {
        "isDragging": "boolean"
      },
      "effects": [
        "FileReader for upload",
        "Drag-and-drop file handling"
      ]
    },
    {
      "name": "SimplePreviewModal",
      "file": "src/components/customizer/SimplePreviewModal.tsx",
      "props": {
        "isOpen": "boolean",
        "previewData": "PreviewData | null",
        "onClose": "() => void"
      },
      "state": {},
      "effects": [
        "AnimatePresence animations",
        "Download creates temp DOM <a> element"
      ]
    }
  ],
  
  "store": {
    "file": "None (using local component state)",
    "stateShape": {
      "ui": {
        "showWizard": "boolean",
        "showChangeProduct": "boolean",
        "showPreview": "boolean",
        "previewData": "PreviewData | null",
        "editorMode": "boolean",
        "mockupDimensions": "{ width: number, height: number }"
      },
      "product": {
        "productId": "string",
        "currentSide": "ProductSide",
        "selectedColor": "string",
        "selectedSize": "string"
      },
      "design": {
        "designImage": "string | null (base64)",
        "selectedPlacement": "string | null",
        "scale": "number (0.3-1.0)"
      }
    },
    "actions": {
      "Direct useState setters": [
        "setShowWizard",
        "setShowPreview",
        "setProductId",
        "setCurrentSide",
        "setSelectedColor",
        "setSelectedSize",
        "setDesignImage",
        "setSelectedPlacement",
        "setScale"
      ]
    }
  },
  
  "uiSummary": {
    "elements": [
      "ProductWizard modal (4-step product selection)",
      "SimplePlacementPanel sidebar (upload, placement, scale, color, size)",
      "SimplePlacementCanvas (mockup + design render)",
      "SimplePreviewModal (full-size preview + download)",
      "Print area overlay (dashed border)",
      "Placement guide (blue box when no design)",
      "Dev mode print area editor (draggable box)"
    ],
    "interactions": [
      "Wizard: Select product type → fit → sleeve → color/size → Start Designing",
      "Upload: Drag/drop or file picker → converts to base64 → renders on canvas",
      "Placement: Click placement button → design repositions instantly",
      "Scale: Drag slider → design scales in real-time (aspect-preserved)",
      "Side: Click Front/Back → canvas redraws with new mockup (design cleared)",
      "Preview: Click Generate Preview → modal opens with PNG + metadata",
      "Download: Click Download → browser downloads preview.png"
    ]
  },
  
  "bugs": [
    {
      "id": "BUG-1",
      "message": "Design lost when switching sides (should persist per-side)",
      "file": "src/pages/Customizer.tsx",
      "line": 100,
      "severity": "high",
      "fix": "Change designImage from single state to Record<ProductSide, string | null>"
    },
    {
      "id": "BUG-2",
      "message": "Placement auto-selected on side change even if no design uploaded",
      "file": "src/pages/Customizer.tsx",
      "line": 103,
      "severity": "medium",
      "fix": "Check if design exists for new side before auto-selecting placement"
    },
    {
      "id": "BUG-3",
      "message": "No cart integration - preview only logs to console",
      "file": "src/pages/Customizer.tsx",
      "line": 131,
      "severity": "high",
      "fix": "Call useCartStore().addItem() with customDesign payload"
    },
    {
      "id": "BUG-4",
      "message": "Dev mode editor button visible in production builds",
      "file": "src/pages/Customizer.tsx",
      "line": 164,
      "severity": "low",
      "fix": "Use import.meta.env.MODE === 'development' check"
    },
    {
      "id": "BUG-5",
      "message": "Scale slider range too limited (0.3x min, some designs need smaller)",
      "file": "src/components/customizer/SimplePlacementPanel.tsx",
      "line": 234,
      "severity": "low",
      "fix": "Change min from 0.3 to 0.1"
    },
    {
      "id": "BUG-6",
      "message": "No image resolution validation (low-res images will print blurry)",
      "file": "src/components/customizer/SimplePlacementPanel.tsx",
      "line": 79,
      "severity": "medium",
      "fix": "Add image.naturalWidth/Height check after FileReader.onload, warn if <300px"
    },
    {
      "id": "BUG-7",
      "message": "Typo in mockup path: 'balck-front.png' should be 'black-front.png'",
      "file": "src/config/productTemplates.ts",
      "line": 28,
      "severity": "medium",
      "fix": "Find/replace balck → black"
    },
    {
      "id": "BUG-8",
      "message": "No loading states during image processing",
      "file": "src/components/customizer/SimplePlacementCanvas.tsx",
      "line": null,
      "severity": "low",
      "fix": "Add isLoading state and spinner while images load"
    }
  ],
  
  "missingFeatures": [
    "Add to cart (critical)",
    "Multi-side design persistence (high)",
    "Multiple designs per side (high)",
    "Manual drag positioning (high)",
    "Text elements (high)",
    "Undo/Redo history (high)",
    "Design library browser (medium)",
    "Resize handles (medium)",
    "Rotation (medium)",
    "Layer management (medium)",
    "Copy design to other sides (medium)",
    "Save draft (medium)",
    "Keyboard shortcuts (low)",
    "Grid overlay (low)",
    "Zoom controls (low)",
    "Real-time price calculation (low)",
    "Accessibility (ARIA) (low)"
  ],
  
  "payloadSpec": {
    "current": {
      "preview": "string (base64 PNG)",
      "design": {
        "image": "string (base64)",
        "placement": "string (placement ID)",
        "scale": "number",
        "side": "ProductSide",
        "color": "string",
        "size": "string",
        "productId": "string"
      },
      "timestamp": "number"
    },
    "recommended": {
      "productId": "string",
      "productType": "ProductType",
      "productName": "string",
      "size": "string",
      "color": "string",
      "quantity": "number",
      "price": "number",
      "customDesign": {
        "imageUrl": "string (base64)",
        "placement": "string",
        "scale": "number",
        "side": "ProductSide",
        "position": { "x": "number", "y": "number" },
        "dimensions": { "width": "number", "height": "number" }
      },
      "preview": "string (base64 PNG)"
    }
  },
  
  "printAreas": {
    "found": true,
    "file": "src/config/printAreas.ts",
    "schema": {
      "type": "Record<ProductType, ProductPrintAreas>",
      "structure": {
        "productType": {
          "side": {
            "placement": {
              "x": "number (px)",
              "y": "number (px)",
              "width": "number (px)",
              "height": "number (px)"
            }
          }
        }
      },
      "coordinateSystem": "Top-left origin (0,0), pixel units, relative to mockup image",
      "helpers": [
        "getPrintArea(productType, side, placement)",
        "getAvailablePlacementsForSide(productType, side)",
        "calculateFitDimensions(imgW, imgH, printArea)",
        "scaleDesign(w, h, scale, printArea, min, max)",
        "getMockupPath(productType, color, side)"
      ]
    }
  },
  
  "tests": {
    "unit": [
      {
        "file": "tests/customizer/SimplePlacementCanvas.test.tsx",
        "cases": [
          "Renders canvas with mockup",
          "Draws design at correct position",
          "Preserves aspect ratio",
          "Applies scale factor",
          "Enforces print area boundaries"
        ]
      },
      {
        "file": "tests/customizer/SimplePlacementPanel.test.tsx",
        "cases": [
          "File upload converts to base64",
          "Drag-and-drop works",
          "Placement selection updates",
          "Scale slider works",
          "Generate button disabled when no design"
        ]
      },
      {
        "file": "tests/config/printAreas.test.ts",
        "cases": [
          "getPrintArea returns correct coordinates",
          "calculateFitDimensions preserves aspect",
          "scaleDesign enforces min/max"
        ]
      }
    ],
    "integration": [
      {
        "file": "tests/customizer/CustomizerFlow.test.tsx",
        "cases": [
          "Wizard to canvas workflow",
          "Product selection updates canvas",
          "Upload → placement → preview flow",
          "Side switching",
          "Color/size changes"
        ]
      },
      {
        "file": "tests/customizer/CartIntegration.test.tsx",
        "cases": [
          "Add design to cart (when implemented)",
          "Cart payload structure validation",
          "Multiple cart items"
        ]
      }
    ],
    "e2e": [
      {
        "file": "e2e/customizer-happy-path.spec.ts",
        "scenario": "Complete design workflow from wizard to download"
      },
      {
        "file": "e2e/customizer-edge-cases.spec.ts",
        "scenario": "Invalid uploads, side switching, oversized files"
      }
    ]
  },
  
  "todoAtomic": [
    {
      "id": "T1",
      "task": "Fix BUG-3: Implement cart integration",
      "difficulty": "small",
      "acceptance": "Clicking 'Generate Preview' adds item to cart with customDesign payload. Cart icon shows count. Toast confirms 'Added to cart'.",
      "files": ["src/pages/Customizer.tsx"],
      "priority": "critical"
    },
    {
      "id": "T2",
      "task": "Fix BUG-1: Per-side design persistence",
      "difficulty": "small",
      "acceptance": "Switching from front to back preserves front design. Can upload separate design for back. Both designs render correctly.",
      "files": ["src/pages/Customizer.tsx"],
      "priority": "critical"
    },
    {
      "id": "T3",
      "task": "Fix BUG-7: Correct mockup path typo",
      "difficulty": "small",
      "acceptance": "Find/replace 'balck' → 'black'. All mockups load correctly.",
      "files": ["src/config/productTemplates.ts"],
      "priority": "high"
    },
    {
      "id": "T4",
      "task": "Add loading states to canvas",
      "difficulty": "small",
      "acceptance": "Spinner shows while mockup loads. Design renders only after load complete.",
      "files": ["src/components/customizer/SimplePlacementCanvas.tsx"],
      "priority": "high"
    },
    {
      "id": "T5",
      "task": "Add image resolution validation",
      "difficulty": "small",
      "acceptance": "Warn if uploaded image <300x300px. Show toast: 'Low resolution image may print blurry'.",
      "files": ["src/components/customizer/SimplePlacementPanel.tsx"],
      "priority": "medium"
    },
    {
      "id": "T6",
      "task": "Add error toast UI",
      "difficulty": "small",
      "acceptance": "Replace alert() calls with toast notifications. Errors show red toast, success shows green.",
      "files": ["src/components/customizer/SimplePlacementPanel.tsx"],
      "priority": "medium"
    },
    {
      "id": "T7",
      "task": "Fix placement auto-select on side change",
      "difficulty": "small",
      "acceptance": "Switching sides without design keeps placement null. Auto-select only after upload.",
      "files": ["src/pages/Customizer.tsx"],
      "priority": "medium"
    },
    {
      "id": "T8",
      "task": "Extend scale slider min to 0.1x",
      "difficulty": "small",
      "acceptance": "Scale slider allows 0.1x - 1.0x range. Updates label text.",
      "files": ["src/components/customizer/SimplePlacementPanel.tsx"],
      "priority": "low"
    },
    {
      "id": "T9",
      "task": "Hide dev editor in production",
      "difficulty": "small",
      "acceptance": "Print Area Editor button only shows in dev mode (MODE=development).",
      "files": ["src/pages/Customizer.tsx"],
      "priority": "low"
    },
    {
      "id": "T10",
      "task": "Add file type validation",
      "difficulty": "small",
      "acceptance": "Uploading .txt or non-image shows error toast. Only .png, .jpg, .svg allowed.",
      "files": ["src/components/customizer/SimplePlacementPanel.tsx"],
      "priority": "medium"
    }
  ],
  
  "notes": "Current implementation is a functional MVP for simple placement workflow. Critical blockers: (1) No cart integration, (2) Multi-side designs not persisted. High technical debt from duplicate components (5 control panels, 2 stores). Recommend consolidating to single store (src/store/customizer.ts) for future multi-design features."
}
